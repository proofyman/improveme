<ng-container *ngIf="activities$ | async; let activities">

    <ng-template
      #actionsPortal
      cdkPortal>
      <button
        [routerLink]="['/create-activity']"
        color="primary"
        mat-icon-button>
        <mat-icon>add</mat-icon>
      </button>

      <button
        color="primary"
        (click)="openScoreNotFromListModal()"
        mat-icon-button>
        <mat-icon>check</mat-icon>
      </button>

      <button
        [routerLink]="['/create-tag']"
        color="primary"
        mat-icon-button>
        <mat-icon>bookmark_outline</mat-icon>
      </button>
    </ng-template>

    <mat-menu #menu="matMenu">
      <button
        mat-menu-item>
        Засчитать не из списка
      </button>
    </mat-menu>

    <div class="__tab-heading">
      <div
        (click)="changeTabTo(TAB_INDEXES.COMMON)"
        [class.__tab-link--current]="selectedTabIndex === TAB_INDEXES.COMMON && !tagFilter$.value"
        class="__tab-link">
        Основные
      </div>

      <div
        [class.__tab-link--current]="selectedTabIndex === TAB_INDEXES.ONETIME"
        (click)="changeTabTo(TAB_INDEXES.ONETIME)"
        class="__tab-link">
        Разовые
      </div>

      <div
        *ngFor="let tag of tags$ | async"
        [class.__tab-link--current]="tagFilter$.value === tag.name"
        (click)="filterActivitiesByTag(tag)"
        class="__tab-link">
        {{tag.name}}
      </div>

    </div>

    <div
      style="visibility: hidden; position: fixed"
      [style.left]="contextMenuPosition.x"
      [style.top]="contextMenuPosition.y"
      #itemMenuTrigger
      [matMenuTriggerFor]="itemMenu"
      class="__item-mat-menu-trigger"></div>

    <div class="__container">
      <mat-tab-group [(selectedIndex)]="selectedTabIndex">
        <mat-tab>
          <ng-container *ngIf="activities.length; else zeroState">
            <app-activity-list-item
              *ngFor="let activity of activities$ | async; trackBy: trackByName"
              (press)="openContextMenu($event, activity)"
              [isDoneToday]="isDoneToday(activity)"
              [isEditMode]="isEditMode"
              [name]="activity.name"
              [points]="activity.points"
              (score)="scoreActivity(activity)"
            >
            </app-activity-list-item>
          </ng-container>
        </mat-tab>
        <mat-tab>
          <ng-container *ngIf="oneTimeActivities$ | async; let oneTimeActivities">
            <ng-container *ngIf="oneTimeActivities.length; else zeroState">
              <app-activity-list-item
                *ngFor="let activity of oneTimeActivities; trackBy: trackByName"
                (press)="openContextMenu($event, activity)"
                (onFinishSubtask)="scoreSubtask(activity, $event)"
                [subtasks]="activity.subtasks"
                [isDoneToday]="isDoneToday(activity)"
                [isEditMode]="isEditMode"
                [name]="activity.name"
                [points]="activity.points"
                (score)="scoreActivity(activity)"
              >
              </app-activity-list-item>
            </ng-container>
          </ng-container>
        </mat-tab>
      </mat-tab-group>
    </div>

</ng-container>

<mat-menu #itemMenu="matMenu">
  <ng-template matMenuContent let-activity="activity">
    <button
      (click)="editActivity(activity)"
      mat-menu-item>
      Редактировать
    </button>

    <button
      (click)="hideActivity(activity)"
      mat-menu-item>
      Скрыть
    </button>

    <button
      mat-menu-item
      (click)="splitToSubtasks(activity)"
      *ngIf="activity.isOneTime">
      Разбить на подзадачи
    </button>
  </ng-template>
</mat-menu>

<ng-template #zeroState>
  <div class="__zero-state">
    Нету активностей, которые бы можно было отметить.
  </div>
</ng-template>
